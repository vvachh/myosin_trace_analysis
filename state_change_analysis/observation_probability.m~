function [obsfun_all, obsfun] = observation_probability(gmm)
    % returns a function which computes p(observation|state),
    % given a gaussian mixture model where states are cluster ids and
    % observations are the modeled data.
    
    mus = gmm.mu(:);
    sigmas = sqrt(gmm.Sigma(:));
    mixing = gmm.ComponentProportion(:);
    lsa = 0:0.001:0.2;
    plot(lsa, normpdf(lsa,mus(1),sigmas(1)));hold on;
    plot(lsa, normpdf(lsa,mus(2),sigmas(2)));
    figure;
    plot(lsa, normpdf(lsa,mus(1),sigmas(1))/(normpdf(lsa,mus(1),sigmas(1))+normpdf(lsa,mus(2),sigmas(2))));
    xlabel('observed velocity'); ylabel('p(state 1|velo
    
    function a = all_obs(x)
        a = normpdf(x,mus, sigmas)+1e-100;
        a = a/sum(a);
    end

    function y = obs(x,s)
        a = normpdf(x,mus, sigmas)+1e-100;
        a = a/sum(a);
        y = a(s);
    end

    obsfun_all = @all_obs;
    obsfun = @obs;
end